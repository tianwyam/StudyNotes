

### JVM





#### **垃圾回收**

 

##### **分代回收方式**

 

   **分代回收**是垃圾回收中的一种常见算法。特点是把内存划分成不同的世代，分别对应虚拟机中存活时间不同的对象。对于存活时间不同的对象，可以采用不同的回收策略。    

   

​	对于包含存活时间较短的对象的内存空间，其中所包含的存活对象较少，可以被回收的区域比较多，而且状态变化比较快，因此对这个世代的内存进行回收的频率比较高，速度较快。而对于存活时间比较长的对象，回收的频率可以比较低。       



​	在HotSpot虚拟机中，把内存划分为3个世代：**年轻**、**年老**、**永久**。

​	大部分对象所需内存的分配都是在***年轻代***区域进行的。

​	当垃圾回收器运行时，**年轻代**中的很多对象可能已经不再存活，可以直接被回收。

​	而有些对象可能仍然处于存活状态。某些对象可能经过若干个垃圾回收操作后，仍然处于存活状态，对于这些对象，垃圾回收器会把这些对象移动到**年老代**的内存区域。

​	**永久代**中包含的是java虚拟机自身运行所需的对象。   

​    

​	**年轻代**有划分为：一个伊甸园(**eden)**、两个存活区(**survivor** space)。       

​	大部分内存分配都是在伊甸园(**eden**)中进行的，由于伊甸园的内存空间较小，因此某些所需内存较大的对象无法直接在伊甸园中进行分配，而直接在年老代中进行。   



​	两个存活区(**survivor**   space)中总有一个是空白的，在对年轻代进行垃圾回收时，先把伊甸园中的存活对象复制到当前空白的存活区中，接着对另一个非空白的存活区中的存活对象进行处理。

​	如果对象的存活时间较短，那么同样将其复制到空白的存活区中；如果对象的存活时间较长，则复制到年老代区域。在复制到空白的存活区过程中，如果发现该存活区已经满了，那么将其复制到年老代区域。经过这两次复制后，就可以把伊甸园和非空白的存活区中的内容直接全部清空，因为这两个区域中的对象要么不再存活，要么已复制到其他内存区域中。   

​	在完成垃圾回收后，下一次的内存分配可以继续从空白的伊甸园开始进行，而两个存活区的作用也发生了交换。   

 

对于年老代和永久代内存区域，通常采用的是另一种回收算法: **标记清除压缩算法**。

 

##### **标记清除压缩算法**

 

   **标记清除压缩算法**分为三个步骤：标记(mark)、清除(sweep)、压缩(compact).   

​	第一个步骤的作用是扫描整个内存区域，把当前仍然存活的对象**标记**出来；   

​	第二个步骤的作用则是清理内存区域，**清除**垃圾；   

​	第三个步骤的作用是**压缩**整个内存区域，把存活对象所占的内存都移动到内存区域的起始位置，使内存中可用区域是连续的。   

​	经过压缩后，在年老代和永久代中进行内存分配就变得很容易，只需要从可用区域的开头位置进行分配即可。   

 

 

 

 